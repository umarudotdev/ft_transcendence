# Kamal deployment configuration for ft_transcendence Game Server (AWS)
# Documentation: https://kamal-deploy.org/docs/configuration/overview/

service: ft-transcendence-game

# Docker image (AWS ECR)
image: ft-transcendence-game

# SSH configuration
ssh:
  user: ubuntu
  keys:
    - ~/.ssh/ft-transcendence.pem

# Servers to deploy to (EC2 instances)
servers:
  web:
    hosts:
      - ec2-44-200-135-124.compute-1.amazonaws.com

# Proxy configuration
proxy:
  ssl: true
  host: game.transcendence.umaru.dev
  app_port: 2567
  healthcheck:
    interval: 3
    path: /__healthcheck
    timeout: 3

# AWS ECR registry
registry:
  server: 932249560389.dkr.ecr.us-east-1.amazonaws.com
  username: AWS
  password:
    - KAMAL_REGISTRY_PASSWORD

# Environment variables
env:
  clear:
    NODE_ENV: production
    LOG_FORMAT: json
    LOG_LEVEL: info
  secret:
    - API_URL
    - GAME_INTERNAL_SECRET

# Build configuration
builder:
  arch: amd64
  dockerfile: apps/game/Dockerfile
  target: production
  context: .
  cache:
    type: gha
