# Kamal deployment configuration for ft_transcendence Web (AWS)
# Documentation: https://kamal-deploy.org/docs/configuration/overview/

service: ft-transcendence-web

# Docker image (AWS ECR)
image: ft-transcendence-web

# SSH configuration
ssh:
  user: ubuntu
  keys:
    - ~/.ssh/ft-transcendence.pem

# Servers to deploy to (EC2 instances)
servers:
  web:
    hosts:
      - ec2-44-200-135-124.compute-1.amazonaws.com

# Proxy (Traefik) configuration
proxy:
  ssl: true
  host: transcendence.umaru.dev
  app_port: 3000
  healthcheck:
    interval: 3
    path: /
    timeout: 3

# AWS ECR registry
registry:
  server: 932249560389.dkr.ecr.us-east-1.amazonaws.com
  username: AWS
  password:
    - KAMAL_REGISTRY_PASSWORD

# Environment variables
env:
  clear:
    NODE_ENV: production
    PORT: "3000"
  secret:
    # API URL for server-side proxy (via kamal-proxy)
    - API_URL

# Build configuration
builder:
  arch: amd64
  dockerfile: apps/web/Dockerfile
  target: production
  context: .
